<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Baba Tillu Pro Version (with hidden admin ‚ùå)</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#060606;
      --card: rgba(20,20,20,0.9);
      --accent: #ff3b3b;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box;font-family:'Poppins',sans-serif}
    body{
      margin:0;min-height:100vh;background:var(--bg);color:#fff;
      display:flex;align-items:center;justify-content:center;padding:20px;
      background-size:cover;background-position:center;
      transition:background-image .4s ease-in-out;
    }
    .app {
      width:100%; max-width:960px; margin:auto;
      background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.6));
      border-radius:12px; padding:18px; box-shadow:0 6px 30px rgba(0,0,0,0.6);
    }

    /* HEADER */
    .header {
      display:flex;align-items:center;gap:14px;
      padding:8px 12px;border-radius:10px;
    }
    .logo-circle{
      width:64px;height:64px;border-radius:50%;overflow:hidden;border:3px solid #fff;
      flex:0 0 64px;background:#222;display:flex;align-items:center;justify-content:center;
    }
    .logo-circle img{width:100%;height:100%;object-fit:cover;}
    .title{
      font-size:20px;font-weight:700;color:var(--accent);text-shadow:0 0 12px rgba(255,59,59,0.25);
    }
    .subtitle{font-size:12px;color:#ddd;opacity:.85}

    /* hidden admin cross */
    .admin-cross {
      position: fixed;
      right: 14px;
      bottom: 14px;
      width: 40px;
      height: 40px;
      border-radius:8px;
      background: rgba(255,255,255,0.02);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:900;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,0.6);
      z-index:9999;
      opacity:0.6;
    }
    .admin-cross:hover{opacity:1;transform:scale(1.02)}

    /* platform sel */
    .platforms { display:flex;flex-wrap:wrap;gap:8px;margin-top:12px }
    .plat { background:var(--glass); padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);cursor:pointer; user-select:none }
    .plat.active { box-shadow:0 6px 18px rgba(0,0,0,0.6); transform:translateY(-2px); border-color:var(--accent) }

    /* main area */
    .main { display:grid; grid-template-columns: 1fr 360px; gap:18px; margin-top:16px; align-items:start; }
    @media(max-width:920px){ .main{grid-template-columns:1fr;}}
    .card { background:var(--card); padding:14px;border-radius:10px; min-height:240px; box-shadow:0 6px 20px rgba(0,0,0,0.5) }

    /* login / key input */
    .input-row{display:flex;gap:8px;margin-top:8px}
    input[type="text"], input[type="password"], select {
      width:100%; padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
      background:rgba(255,255,255,0.02); color:#fff;
    }
    button { padding:10px 12px;border-radius:8px;border:none;background:var(--accent); color:#fff; cursor:pointer; font-weight:600 }
    .muted { color:#aaa;font-size:13px;margin-top:8px }

    /* admin panel small */
    .admin-panel { display:none; margin-top:12px; gap:10px; }
    .admin-open { margin-left:auto; font-size:13px; background:transparent;border:1px solid rgba(255,255,255,0.06); color:#fff; padding:6px 10px;border-radius:8px; cursor:pointer }

    /* prediction page */
    .prediction-title { font-weight:800; color:var(--accent); font-size:22px; text-shadow:0 0 8px rgba(255,59,59,0.2) }
    .box { display:inline-block;padding:8px 10px;border-radius:8px;background:rgba(0,0,0,0.35); border:1px solid rgba(255,255,255,0.04); min-width:90px; text-align:center; font-weight:700 }
    .period-box{ color: #ffd54a }
    .signal.big { color: #7fe8a7 }
    .signal.small { color: #ffb66b }
    .number-box{ color:#9be3ff }

    .predict-btn{ margin-top:12px;background:#fff;color:#000;padding:10px;border-radius:8px;font-weight:700 }
    .live { margin-top:8px;font-size:14px;color:#cfcfcf }

    /* modal */
    .modal {
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.6); z-index:9999; visibility:hidden; opacity:0; transition:all .2s;
    }
    .modal.show{ visibility:visible; opacity:1 }
    .modal .modal-card { background:#111;padding:18px;border-radius:10px; min-width:280px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.7) }
    .small-muted{font-size:13px;color:#bbb;margin-top:8px}

    footer{ margin-top:12px;font-size:13px;color:#bbb;text-align:center }

  </style>
</head>
<body>

<div class="app">

  <!-- HEADER -->
  <div class="header">
    <div class="logo-circle">
      <img id="logo-img" src="anime1.png" alt="logo">
    </div>
    <div>
      <div class="title">Baba Tillu Pro Version</div>
      <div class="subtitle">Unlock & play ‚Äî Enter your key below</div>
    </div>
  </div>

  <!-- hidden admin cross -->
  <div class="admin-cross" id="adminCross">‚ùå</div>

  <!-- PLATFORMS -->
  <div class="platforms" id="platforms"></div>

  <div class="main">
    <!-- LEFT: login / info -->
    <div class="card" id="home-card">
      <h3>Enter Key</h3>
      <div class="muted">Type your access key to open the prediction page</div>

      <div class="input-row" style="margin-top:12px">
        <input id="userKeyInput" type="text" placeholder="Enter key here">
        <button onclick="unlockWithKey()">Enter</button>
      </div>
      <div id="homeMsg" class="small-muted"></div>

      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)">

      <div class="muted">Choose game (for display & selection):</div>
      <div id="chosenPlatform" style="margin-top:8px;font-weight:700">None</div>

      <div style="margin-top:12px">
        <!-- Demo removed as requested -->
      </div>

      <!-- ADMIN PANEL -->
      <div class="admin-panel card" id="adminPanel" style="display:none;margin-top:12px">
        <h3 style="margin-top:0">Admin Panel</h3>

        <div id="adminControls" style="display:none;margin-top:12px">
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button onclick="createPresetKey(30)">Create 30 min key</button>
            <button onclick="createPresetKey(60)">Create 1 hour key</button>
            <button onclick="createPresetKey(1440)">Create 1 day key</button>
            <button onclick="createPresetKey(4320)">Create 3 day key</button>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <input id="customMinutes" type="text" placeholder="Custom minutes e.g. 90">
            <button onclick="createCustom()">Create custom key</button>
          </div>

          <div style="margin-top:12px">
            <label>Background image for pages:</label>
            <select id="bgSelect">
              <option value="anime1.png">anime1.png</option>
              <option value="anime2.png">anime2.png</option>
              <option value="anime-character-3.png">anime-character-3.png</option>
            </select>
            <button onclick="applyBackground()">Apply</button>
          </div>

          <div style="margin-top:12px">
            <label>Music filename:</label>
            <input id="musicFile" type="text" placeholder="music.mp4" value="music.m4a" style="width:160px">
            <button onclick="applyMusic()">Apply</button>
            <div class="small-muted">Note: Browser may block autoplay until user interacts.</div>
          </div>

          <div style="margin-top:12px">
            <h4 style="margin:0 0 8px 0">Existing Keys (localStorage)</h4>
            <div id="keysList" style="max-height:140px;overflow:auto"></div>
            <div style="margin-top:8px">
              <button onclick="clearExpired()">Clear expired</button>
              <button onclick="deleteAllKeys()">Delete all keys</button>
            </div>
          </div>

        </div>

      </div>
    </div>

    <!-- RIGHT: prediction page (hidden initially) -->
    <div class="card" id="predictionCard" style="display:none">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div>
          <div class="prediction-title">Baba Tillu Pro Version</div>
          <div class="muted" style="margin-top:4px">Signal & predicted numbers</div>
        </div>
        <div>
          <div style="font-size:13px;color:#ccc">Active Key: <span id="activeKeyLabel">‚Äî</span></div>
          <div style="font-size:12px;color:#bbb">Expires in: <span id="expiresIn">‚Äî</span></div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div>PERIOD: <span class="box period-box" id="periodBox">--</span></div>
        <div style="margin-top:8px">SIGNAL: <span class="box signal" id="signalBox">--</span></div>
        <div style="margin-top:8px">PREDICTED NUMBERS: <span class="box number-box" id="numbersBox">-- / --</span></div>

        <!-- Manual period input -->
        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <input id="periodInput" type="text" placeholder="Enter period number (e.g. 202509130001)" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff">
          <button class="predict-btn" onclick="generateOnce()">Generate</button>
        </div>

        <!-- Win / Loss buttons and stats -->
        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <button onclick="markResult('win')">Win</button>
          <button onclick="markResult('loss')">Loss</button>
          <div style="margin-left:auto;text-align:right">
            <div id="statsText" class="small-muted">Wins: 0 ‚Ä¢ Losses: 0 ‚Ä¢ Accuracy: 0%</div>
            <div id="lastCount" class="small-muted">(Last 0 results)</div>
          </div>
        </div>

        <div class="live" id="liveBox">Manual generate only ‚Äî Auto-refresh disabled</div>
        <div style="margin-top:12px">
          <button style="margin-right:8px" onclick="logoutNow()">Logout</button>
        </div>

        <!-- optional: show last results (limited to 10) -->
        <div style="margin-top:12px">
          <div style="font-weight:700;margin-bottom:6px">Last results (latest first, max 10)</div>
          <div id="resultsList" style="max-height:160px;overflow:auto;border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.03);background:rgba(0,0,0,0.25)"></div>
        </div>

      </div>
    </div>

  </div>

  <footer>Made for you ‚Äî Change assets: <code>anime1.png</code>, <code>anime2.png</code>, <code>music.mp4</code></footer>

</div>

<!-- audio element for background music -->
<audio id="bgAudio" src="music.m4a" loop preload="auto"></audio>

<!-- modal -->
<div id="modal" class="modal"><div class="modal-card">
  <div id="modalText" style="font-weight:700;color:var(--accent);font-size:16px">Modal</div>
  <div class="small-muted" style="margin-top:8px" id="modalSub"></div>
  <div style="margin-top:12px"><button onclick="closeModal()">OK</button></div>
</div></div>

<script>
const PLATFORMS = ["Tashan win","Jalwa game","Daman","DM win","51 game","OK win","Tashan X"];
const ADMIN_SECRET = "Mrperfect456"; // DO NOT DISPLAY

function readKeys(){ try{ return JSON.parse(localStorage.getItem('bt_keys')||'[]') }catch(e){ return [] } }
function writeKeys(arr){ localStorage.setItem('bt_keys', JSON.stringify(arr)) }

function readResults(){ try{ return JSON.parse(localStorage.getItem('bt_results')||'[]') }catch(e){ return [] } }
function writeResults(arr){ localStorage.setItem('bt_results', JSON.stringify(arr)) }

function formatRemaining(ms){
  if(ms<=0) return "Expired";
  let s = Math.floor(ms/1000);
  let d = Math.floor(s/86400); s%=86400;
  let h = Math.floor(s/3600); s%=3600;
  let m = Math.floor(s/60); s%=60;
  if(d>0) return `${d}d ${h}h ${m}m`;
  if(h>0) return `${h}h ${m}m ${s}s`;
  if(m>0) return `${m}m ${s}s`;
  return `${s}s`;
}

/* ----------------- UI init ----------------- */
const platformsContainer = document.getElementById('platforms');
const chosenPlatform = document.getElementById('chosenPlatform');
PLATFORMS.forEach((p,idx)=>{
  const b = document.createElement('div');
  b.className = 'plat';
  b.textContent = p;
  b.onclick = ()=>{ document.querySelectorAll('.plat').forEach(x=>x.classList.remove('active')); b.classList.add('active'); chosenPlatform.textContent = p; };
  platformsContainer.appendChild(b);
});

// admin cross click -> prompt for password
document.getElementById('adminCross').addEventListener('click', ()=>{
  const pw = prompt('Enter admin key:');
  if(pw === null) return; // canceled
  if(pw === ADMIN_SECRET){
    document.getElementById('adminPanel').style.display = 'block';
    document.getElementById('adminControls').style.display = 'block';
    renderKeysList();
    showModal('Admin unlocked','You can now create keys and change assets.');
  } else {
    alert('Wrong key.');
  }
});

function renderKeysList(){
  const list = readKeys();
  const el = document.getElementById('keysList');
  if(!list.length){ el.innerHTML = '<div class="small-muted">No keys created yet.</div>'; return; }
  el.innerHTML = '';
  list.forEach(k=>{
    const row = document.createElement('div');
    row.style.padding='8px'; row.style.borderBottom='1px solid rgba(255,255,255,0.03)';
    row.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <div style="word-break:break-all"><strong>${k.key}</strong><div style="color:#bbb;font-size:12px">${new Date(k.expiresAt).toLocaleString()}</div></div>
      <div style="text-align:right">
        <div style="font-size:13px">${k.durationMinutes} min</div>
        <div style="font-size:12px;color:#ccc">${formatRemaining(k.expiresAt - Date.now())}</div>
        <div style="margin-top:6px"><button onclick="deleteKey('${k.key}')">Delete</button></div>
      </div></div>`;
    el.appendChild(row);
  });
}

/* --------------- Admin actions -------------- */
function generateKeyString(len=8){
  const chars = 'ABCDEFGHJKMNPQRSTUVWXYZ23456789';
  let s='';
  for(let i=0;i<len;i++) s+=chars[Math.floor(Math.random()*chars.length)];
  return s;
}
function createPresetKey(minutes){ createKey(minutes); }
function createCustom(){ const val = parseInt(document.getElementById('customMinutes').value); if(!val || val <= 0){ showModal('Invalid minutes','Enter a positive number'); return; } createKey(val); }
function createKey(minutes){ const k = generateKeyString(10); const expiresAt = Date.now() + minutes*60*1000; const arr = readKeys(); arr.push({key:k, expiresAt, durationMinutes: minutes}); writeKeys(arr); renderKeysList(); showModal('Key created',`Key: ${k}
Valid for ${minutes} minutes.`); }
function deleteKey(key){ let arr = readKeys().filter(k=>k.key !== key); writeKeys(arr); renderKeysList(); }
function clearExpired(){ let arr = readKeys().filter(k=>k.expiresAt > Date.now()); writeKeys(arr); renderKeysList(); }
function deleteAllKeys(){ if(!confirm('Delete all keys?')) return; localStorage.removeItem('bt_keys'); renderKeysList(); showModal('All keys deleted','Storage cleared.'); }

/* ------- background & music control -------- */
function applyBackground(){ const sel = document.getElementById('bgSelect').value || 'anime1.png'; document.body.style.backgroundImage = `url('${sel}')`; document.getElementById('logo-img').src = sel; showModal('Background applied', sel); }
function applyMusic(){ const f = document.getElementById('musicFile').value || 'music.mp4'; const a = document.getElementById('bgAudio'); a.src = f; a.load(); showModal('Music set', f); }

/* --------------- Key usage ------------------ */
function unlockWithKey(){
  const input = document.getElementById('userKeyInput').value.trim();
  const all = readKeys();
  if(!input){ document.getElementById('homeMsg').textContent = 'Please enter a key.'; return; }
  const found = all.find(k=>k.key === input);
  if(!found){ document.getElementById('homeMsg').textContent = 'Invalid key.'; return; }
  if(found.expiresAt <= Date.now()){ document.getElementById('homeMsg').textContent = 'Key expired.'; return; }

  sessionStorage.setItem('bt_active', JSON.stringify({key: found.key, expiresAt: found.expiresAt}));
  openPredictionPage();
}

function openPredictionPage(){
  document.getElementById('predictionCard').style.display = 'block';
  document.getElementById('homeMsg').textContent = '';
  tryPlayAudio();
  updateActiveKeyInfo();
  loadResultsToUI();
}

/* ------------- Prediction logic (manual only) ------------ */
function generateOnce(){
  const periodInput = document.getElementById('periodInput').value.trim();
  if(!periodInput){ showModal('Enter period','Please enter period number before generating.'); return; }
  const period = periodInput;
  const signal = Math.random() < 0.5 ? 'Small' : 'Big';
  let a,b;
  if(signal === 'Small'){ a = Math.floor(Math.random()*5); b = Math.floor(Math.random()*5); }
  else { a = 5 + Math.floor(Math.random()*5); b = 5 + Math.floor(Math.random()*5); }
  document.getElementById('periodBox').textContent = period;
  const sbox = document.getElementById('signalBox');
  sbox.textContent = signal;
  sbox.className = 'box signal ' + (signal.toLowerCase());
  document.getElementById('numbersBox').textContent = `${a} / ${b}`;
  document.getElementById('liveBox').textContent = 'üîí Manual generate ‚Äî Auto-refresh disabled';
}

/* ------------ results tracking & accuracy ------------- */
function markResult(result){
  // result: 'win' or 'loss'
  const period = document.getElementById('periodBox').textContent;
  const signal = document.getElementById('signalBox').textContent;
  if(!period || period==='--'){ showModal('No prediction','Generate prediction first then mark win/loss.'); return; }
  const ts = Date.now();
  const resArr = readResults();
  // push new result at start
  resArr.unshift({period,signal,result,ts});
  // keep only last 10
  const trimmed = resArr.slice(0,10);
  writeResults(trimmed);
  loadResultsToUI();
}

function loadResultsToUI(){
  const arr = readResults();
  const listEl = document.getElementById('resultsList');
  listEl.innerHTML = '';
  let wins=0, losses=0;
  arr.forEach(r=>{
    const div = document.createElement('div');
    div.style.padding='6px 4px';
    div.style.borderBottom='1px solid rgba(255,255,255,0.03)';
    div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-size:13px"><strong>${r.period}</strong><div style="font-size:12px;color:#bbb">${r.signal} ‚Ä¢ ${r.result}</div></div>
      <div style="font-size:12px;color:#ccc">${new Date(r.ts).toLocaleTimeString()}</div>
    </div>`;
    listEl.appendChild(div);
    if(r.result === 'win') wins++; else losses++;
  });
  const total = wins + losses;
  const acc = total ? Math.round((wins/total)*100) : 0;
  document.getElementById('statsText').textContent = `Wins: ${wins} ‚Ä¢ Losses: ${losses} ‚Ä¢ Accuracy: ${acc}%`;
  document.getElementById('lastCount').textContent = `(Last ${total} result${total!==1?'s':''})`;
}

/* ------------ session / expiry ------------- */
function getActiveSession(){ try{ return JSON.parse(sessionStorage.getItem('bt_active')) }catch(e){ return null } }
function checkSessionValidity(){ const s = getActiveSession(); if(!s) return false; return s.expiresAt > Date.now(); }
function updateActiveKeyInfo(){
  const s = getActiveSession();
  if(!s){ document.getElementById('activeKeyLabel').textContent = '‚Äî'; document.getElementById('expiresIn').textContent = '‚Äî'; return; }
  document.getElementById('activeKeyLabel').textContent = s.key;
  const diff = s.expiresAt - Date.now();
  document.getElementById('expiresIn').textContent = formatRemaining(diff);
  if(window._expiresInterval) clearInterval(window._expiresInterval);
  window._expiresInterval = setInterval(()=>{
    const st = getActiveSession();
    if(!st){ document.getElementById('expiresIn').textContent = '‚Äî'; clearInterval(window._expiresInterval); return; }
    const rem = st.expiresAt - Date.now();
    if(rem<=0){ document.getElementById('expiresIn').textContent = 'Expired'; expireSessionHandler(); clearInterval(window._expiresInterval); return; }
    document.getElementById('expiresIn').textContent = formatRemaining(rem);
  },1000);
}

function expireSessionHandler(){
  sessionStorage.removeItem('bt_active');
  showModal('Your key expired','You will be redirected to homepage.', ()=>{
    document.getElementById('predictionCard').style.display = 'none';
    document.getElementById('homeMsg').textContent = 'Your key expired. Please enter a valid key.';
    stopAudio();
  });
}

function logoutNow(){
  sessionStorage.removeItem('bt_active');
  document.getElementById('predictionCard').style.display = 'none';
  document.getElementById('homeMsg').textContent = 'Logged out.';
  stopAudio();
}

/* Modal util */
function showModal(title, sub='', cb){
  document.getElementById('modalText').textContent = title;
  document.getElementById('modalSub').textContent = sub;
  const m = document.getElementById('modal');
  m.classList.add('show');
  m._cb = cb || null;
}
function closeModal(){ const m = document.getElementById('modal'); m.classList.remove('show'); if(m._cb){ m._cb(); m._cb = null; } }

/* audio control */
function tryPlayAudio(){ const a = document.getElementById('bgAudio'); a.loop = true; a.volume = 0.6; a.play().catch(()=>{}); }
function stopAudio(){ const a = document.getElementById('bgAudio'); try{ a.pause(); a.currentTime = 0; }catch(e){} }

/* Init */

(function init(){
  // Home page background and logo
  document.body.style.backgroundImage = `url('anime2.png')`;
  document.getElementById('logo-img').src = 'anime2.png';
  renderKeysList();
  if(checkSessionValidity()) openPredictionPage();
  // keep keys list tidy each hour
  setInterval(()=>{ const arr = readKeys().filter(k=>k.expiresAt > Date.now()); writeKeys(arr); renderKeysList(); }, 60*60*1000);
  updateActiveKeyInfo();
})();

// When prediction page is shown, switch background
function openPredictionPage(){
  document.getElementById('predictionCard').style.display = 'block';
  document.getElementById('homeMsg').textContent = '';
  document.body.style.backgroundImage = `url('anime3.png')`;
  tryPlayAudio();
  updateActiveKeyInfo();
  loadResultsToUI();
}

</script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  // Firebase config for terminal-xxrr project
  const firebaseConfig = {
    apiKey: "AIzaSyBs7eQyMrcN8kJWMHl2ac2UZHlYQ6DypD8",
    authDomain: "terminal-xxrr.firebaseapp.com",
    databaseURL: "https://terminal-xxrr-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "terminal-xxrr",
    storageBucket: "terminal-xxrr.appspot.com",
    messagingSenderId: "722753278120",
    appId: "1:722753278120:web:bfa37aab39635a4e57f29d"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  firebase.auth().signInAnonymously()
    .then(()=>console.log("‚úÖ Firebase signed in"))
    .catch(e=>console.error("Auth error", e));

  // Replace key creation with Firebase storage
  function createKey(minutes){
    const key = Math.random().toString(36).substr(2,10).toUpperCase();
    const expiresAt = Date.now() + minutes*60000;
    const obj = { key, expiresAt, minutes };
    return db.ref("keys/"+key).set(obj).then(()=>{
      alert("Key created: "+key);
      renderKeysList();
    });
  }

  function renderKeysList(){
    const el = document.getElementById("keysList");
    if(!el) return;
    el.innerHTML="Loading...";
    db.ref("keys").once("value").then(snap=>{
      el.innerHTML="";
      if(!snap.exists()){el.innerHTML="No keys yet";return;}
      snap.forEach(child=>{
        const v=child.val();
        const div=document.createElement("div");
        div.innerHTML = v.key+" ‚Äî expires "+new Date(v.expiresAt).toLocaleString();
        el.appendChild(div);
      });
    });
  }

  // Unlock with key
  function unlockWithKey(){
    const key=document.getElementById("userKeyInput").value.trim();
    const msg=document.getElementById("homeMsg");
    if(!key){msg.innerText="Enter key";return;}
    db.ref("keys/"+key).once("value").then(snap=>{
      if(!snap.exists()){msg.innerText="Invalid key";return;}
      const v=snap.val();
      if(v.expiresAt<Date.now()){msg.innerText="Key expired";return;}
      sessionStorage.setItem("bt_active", JSON.stringify(v));
      document.getElementById("home-card").style.display="none";
      document.getElementById("predictionCard").style.display="block";
      document.getElementById("activeKeyLabel").innerText=v.key;
    });
  }

  // Delete key
  function deleteKey(k){
    return db.ref("keys/"+k).remove().then(()=>renderKeysList());
  }
</script>

</body>
</html>
